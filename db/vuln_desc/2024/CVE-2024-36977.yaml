cveTags: []
descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    usb: dwc3: Wait unconditionally after issuing EndXfer command


    Currently all controller IP/revisions except DWC3_usb3 >= 310a

    wait 1ms unconditionally for ENDXFER completion when IOC is not

    set. This is because DWC_usb3 controller revisions >= 3.10a

    supports GUCTL2[14: Rst_actbitlater] bit which allows polling

    CMDACT bit to know whether ENDXFER command is completed.


    Consider a case where an IN request was queued, and parallelly

    soft_disconnect was called (due to ffs_epfile_release). This

    eventually calls stop_active_transfer with IOC cleared, hence

    send_gadget_ep_cmd() skips waiting for CMDACT cleared during

    EndXfer. For DWC3 controllers with revisions >= 310a, we don''t

    forcefully wait for 1ms either, and we proceed by unmapping the

    requests. If ENDXFER didn''t complete by this time, it leads to

    SMMU faults since the controller would still be accessing those

    requests.


    Fix this by ensuring ENDXFER completion by adding 1ms delay in

    __dwc3_stop_active_transfer() unconditionally.'
- lang: es
  value: "En el kernel de Linux, se resolvi\xF3 la siguiente vulnerabilidad: usb:\
    \ dwc3: Espere incondicionalmente despu\xE9s de emitir el comando EndXfer Actualmente,\
    \ todas las IP/revisiones del controlador excepto DWC3_usb3 &gt;= 310a esperan\
    \ 1 ms incondicionalmente para que ENDXFER se complete cuando el IOC no est\xE1\
    \ configurado. Esto se debe a que las revisiones del controlador DWC_usb3 &gt;=\
    \ 3.10a admiten el bit GUCTL2[14: Rst_actbitlater] que permite sondear el bit\
    \ CMDACT para saber si se complet\xF3 el comando ENDXFER. Considere un caso en\
    \ el que se puso en cola una solicitud IN y, en paralelo, se llam\xF3 a soft_disconnect\
    \ (debido a ffs_epfile_release). Esto eventualmente llama a stop_active_transfer\
    \ con el IOC borrado, por lo tanto, send_gadget_ep_cmd() omite la espera de que\
    \ CMDACT se borre durante EndXfer. Para los controladores DWC3 con revisiones\
    \ &gt;= 310a, tampoco esperamos forzosamente 1 ms y procedemos a desasignar las\
    \ solicitudes. Si ENDXFER no se complet\xF3 en este momento, se producir\xE1n\
    \ fallas de SMMU ya que el controlador a\xFAn estar\xEDa accediendo a esas solicitudes.\
    \ Solucione este problema asegurando la finalizaci\xF3n de ENDXFER agregando un\
    \ retraso de 1 ms en __dwc3_stop_active_transfer() incondicionalmente."
id: CVE-2024-36977
lastModified: '2024-06-20T12:44:01.637'
metrics: {}
published: '2024-06-18T20:15:13.517'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/1ba145f05b5c8f0b1a947a0633b5edff5dd1f1c5
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/1d26ba0944d398f88aaf997bda3544646cf21945
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/341eb08dbca9eae05308c442fbfab1813a44c97a
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/4a387e032909c6dc2b479452c5bbe9a252057925
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/ec96bcf5f96a7a5c556b0e881ac3e5c3924d542c
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Awaiting Analysis
