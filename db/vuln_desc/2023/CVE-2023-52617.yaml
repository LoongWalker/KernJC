cveTags: []
descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    PCI: switchtec: Fix stdev_release() crash after surprise hot remove


    A PCI device hot removal may occur while stdev->cdev is held open. The call

    to stdev_release() then happens during close or exit, at a point way past

    switchtec_pci_remove(). Otherwise the last ref would vanish with the

    trailing put_device(), just before return.


    At that later point in time, the devm cleanup has already removed the

    stdev->mmio_mrpc mapping. Also, the stdev->pdev reference was not a counted

    one. Therefore, in DMA mode, the iowrite32() in stdev_release() will cause

    a fatal page fault, and the subsequent dma_free_coherent(), if reached,

    would pass a stale &stdev->pdev->dev pointer.


    Fix by moving MRPC DMA shutdown into switchtec_pci_remove(), after

    stdev_kill(). Counting the stdev->pdev ref is now optional, but may prevent

    future accidents.


    Reproducible via the script at

    https://lore.kernel.org/r/20231113212150.96410-1-dns@arista.com'
- lang: es
  value: "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: PCI:\
    \ switchtec: corrige el bloqueo de stdev_release() despu\xE9s de una eliminaci\xF3\
    n sorpresa en caliente. Puede ocurrir una eliminaci\xF3n en caliente del dispositivo\
    \ PCI mientras stdev-&gt;cdev se mantiene abierto. La llamada a stdev_release()\
    \ ocurre durante el cierre o la salida, en un punto mucho m\xE1s all\xE1 de switchtec_pci_remove().\
    \ De lo contrario, la \xFAltima referencia desaparecer\xEDa con el put_device()\
    \ final, justo antes del retorno. En ese momento posterior, la limpieza devm ya\
    \ elimin\xF3 la asignaci\xF3n stdev-&gt;mmio_mrpc. Adem\xE1s, la referencia stdev-&gt;pdev\
    \ no se contaba. Por lo tanto, en modo DMA, iowrite32() en stdev_release() causar\xE1\
    \ un error de p\xE1gina fatal, y el dma_free_coherent() posterior, si se alcanza,\
    \ pasar\xEDa un puntero &amp;stdev-&gt;pdev-&gt;dev obsoleto. Para solucionarlo,\
    \ mueva el apagado de MRPC DMA a switchtec_pci_remove(), despu\xE9s de stdev_kill().\
    \ Contar stdev-&gt;pdev ref ahora es opcional, pero puede evitar accidentes futuros.\
    \ Reproducible a trav\xE9s del script en https://lore.kernel.org/r/20231113212150.96410-1-dns@arista.com"
id: CVE-2023-52617
lastModified: '2024-06-25T22:15:16.043'
metrics: {}
published: '2024-03-18T11:15:09.057'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/0233b836312e39a3c763fb53512b3fa455b473b3
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/1d83c85922647758c1f1e4806a4c5c3cf591a20a
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/4a5d0528cf19dbf060313dffbe047bc11c90c24c
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/d8c293549946ee5078ed0ab77793cec365559355
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/df25461119d987b8c81d232cfe4411e91dcabe66
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/e129c7fa7070fbce57feb0bfc5eaa65eef44b693
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/ff1c7e2fb9e9c3f53715fbe04d3ac47b80be7eb8
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Awaiting Analysis
