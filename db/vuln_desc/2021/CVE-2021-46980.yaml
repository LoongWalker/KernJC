descriptions:
- lang: en
  value: 'In the Linux kernel, the following vulnerability has been resolved:


    usb: typec: ucsi: Retrieve all the PDOs instead of just the first 4


    commit 4dbc6a4ef06d ("usb: typec: ucsi: save power data objects

    in PD mode") introduced retrieval of the PDOs when connected to a

    PD-capable source. But only the first 4 PDOs are received since

    that is the maximum number that can be fetched at a time given the

    MESSAGE_IN length limitation (16 bytes). However, as per the PD spec

    a connected source may advertise up to a maximum of 7 PDOs.


    If such a source is connected it''s possible the PPM could have

    negotiated a power contract with one of the PDOs at index greater

    than 4, and would be reflected in the request data object''s (RDO)

    object position field. This would result in an out-of-bounds access

    when the rdo_index() is used to index into the src_pdos array in

    ucsi_psy_get_voltage_now().


    With the help of the UBSAN -fsanitize=array-bounds checker enabled

    this exact issue is revealed when connecting to a PD source adapter

    that advertise 5 PDOs and the PPM enters a contract having selected

    the 5th one.


    [  151.545106][   T70] Unexpected kernel BRK exception at EL1

    [  151.545112][   T70] Internal error: BRK handler: f2005512 [#1] PREEMPT SMP

    ...

    [  151.545499][   T70] pc : ucsi_psy_get_prop+0x208/0x20c

    [  151.545507][   T70] lr : power_supply_show_property+0xc0/0x328

    ...

    [  151.545542][   T70] Call trace:

    [  151.545544][   T70]  ucsi_psy_get_prop+0x208/0x20c

    [  151.545546][   T70]  power_supply_uevent+0x1a4/0x2f0

    [  151.545550][   T70]  dev_uevent+0x200/0x384

    [  151.545555][   T70]  kobject_uevent_env+0x1d4/0x7e8

    [  151.545557][   T70]  power_supply_changed_work+0x174/0x31c

    [  151.545562][   T70]  process_one_work+0x244/0x6f0

    [  151.545564][   T70]  worker_thread+0x3e0/0xa64


    We can resolve this by instead retrieving and storing up to the

    maximum of 7 PDOs in the con->src_pdos array. This would involve

    two calls to the GET_PDOS command.'
- lang: es
  value: "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: usb:\
    \ typec: ucsi: recupera todos los PDO en lugar de solo los primeros 4 commits\
    \ 4dbc6a4ef06d (\"usb: typec: ucsi: guarda objetos de datos de energ\xEDa en modo\
    \ PD\") introdujo la recuperaci\xF3n de los PDO cuando se conectan a una fuente\
    \ compatible con PD. Pero solo se reciben los primeros 4 PDO, ya que ese es el\
    \ n\xFAmero m\xE1ximo que se puede recuperar a la vez dada la limitaci\xF3n de\
    \ longitud de MESSAGE_IN (16 bytes). Sin embargo, seg\xFAn las especificaciones\
    \ de PD, una fuente conectada puede anunciar hasta un m\xE1ximo de 7 PDO. Si dicha\
    \ fuente est\xE1 conectada, es posible que el PPM haya negociado un contrato de\
    \ energ\xEDa con uno de los PDO con un \xEDndice mayor que 4, y se reflejar\xED\
    a en el campo de posici\xF3n del objeto del objeto de datos de solicitud (RDO).\
    \ Esto dar\xEDa como resultado un acceso fuera de los l\xEDmites cuando se usa\
    \ rdo_index() para indexar en la matriz src_pdos en ucsi_psy_get_voltage_now().\
    \ Con la ayuda del verificador UBSAN -fsanitize=array-bounds habilitado, este\
    \ problema exacto se revela cuando se conecta a un adaptador de fuente PD que\
    \ anuncia 5 PDO y el PPM firma un contrato despu\xE9s de seleccionar el quinto.\
    \ [ 151.545106][ T70] Excepci\xF3n inesperada de BRK del kernel en EL1 [ 151.545112][\
    \ T70] Error interno: controlador BRK: f2005512 [#1] SMP PREEMPT ... [ 151.545499][\
    \ T70] pc : ucsi_psy_get_prop+0x208/0x20c [ 151.545507 ] [ T70] lr : power_supply_show_property+0xc0/0x328\
    \ ... [ 151.545542][ T70] Rastreo de llamadas: [ 151.545544][ T70] ucsi_psy_get_prop+0x208/0x20c\
    \ [ 151.545546][ T70] power_supply_uevent+0x1a4/0x 2f0 [151.545550][T70] dev_uevent+0x200/0x384\
    \ [ 151.545555][ T70] kobject_uevent_env+0x1d4/0x7e8 [ 151.545557][ T70] power_supply_changed_work+0x174/0x31c\
    \ [ 151.545562][ T70] Process_one_work+0x244/0 x6f0 [ 151.545564][ T70] work_thread+0x3e0/0xa64\
    \ Nosotros Puede resolver esto recuperando y almacenando hasta un m\xE1ximo de\
    \ 7 PDO en la matriz con-&gt;src_pdos. Esto implicar\xEDa dos llamadas al comando\
    \ GET_PDOS."
id: CVE-2021-46980
lastModified: '2024-02-28T14:06:45.783'
metrics: {}
published: '2024-02-28T09:15:37.273'
references:
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/1f4642b72be79757f050924a9b9673b6a02034bc
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/5e9c6f58b01e6fdfbc740390c01f542a35c97e57
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/a453bfd7ef15fd9d524004d3ca7b05353a302911
- source: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
  url: https://git.kernel.org/stable/c/e5366bea0277425e1868ba20eeb27c879d5a6e2d
sourceIdentifier: 416baaa9-dc9f-4396-8d5f-8c081fb06d67
vulnStatus: Awaiting Analysis
